# π’΅ BFS μ¤νμ… μ €μ§€ π“ https://www.acmicpc.net/problem/16940
from collections import deque

n = int(input())  # λ…Έλ“ κ°μ μ…λ ¥
a = [[] for _ in range(n)]  # λΉ μΈμ ‘ λ¦¬μ¤νΈ μ΄κΈ°ν™”

for _ in range(n - 1):
    u, v = map(int, input().split())  # κ°„μ„  μ •λ³΄ μ…λ ¥
    u -= 1  # 1λ¶€ν„° μ‹μ‘ν•λ” μΈλ±μ¤λ¥Ό 0λ¶€ν„° μ‹μ‘ν•λ” μΈλ±μ¤λ΅ λ³€κ²½
    v -= 1  # 1λ¶€ν„° μ‹μ‘ν•λ” μΈλ±μ¤λ¥Ό 0λ¶€ν„° μ‹μ‘ν•λ” μΈλ±μ¤λ΅ λ³€κ²½
    a[u].append(v)  # μ–‘λ°©ν–¥ κ°„μ„  μ¶”κ°€
    a[v].append(u)  # μ–‘λ°©ν–¥ κ°„μ„  μ¶”κ°€

order = list(map(int, input().split()))  # λ°©λ¬Έ μμ„ μ…λ ¥
order = [x - 1 for x in order]  # 1λ¶€ν„° μ‹μ‘ν•λ” μΈλ±μ¤λ¥Ό 0λ¶€ν„° μ‹μ‘ν•λ” μΈλ±μ¤λ΅ λ³€κ²½

check = [False] * n  # λ…Έλ“ λ°©λ¬Έ μ—¬λ¶€λ¥Ό μ €μ¥ν•λ” λ°°μ—΄ μ΄κΈ°ν™”
parent = [-1] * n  # κ° λ…Έλ“μ λ¶€λ¨ λ…Έλ“λ¥Ό μ €μ¥ν•λ” λ°°μ—΄ μ΄κΈ°ν™”
q = deque()  # ν μ΄κΈ°ν™”

q.append(0)  # λ£¨νΈ λ…Έλ“λ¥Ό νμ— μ¶”κ°€
check[0] = True  # λ£¨νΈ λ…Έλ“ λ°©λ¬Έ μ²λ¦¬
m = 1  # λ°©λ¬Έ μμ„ λ¦¬μ¤νΈμ μΈλ±μ¤λ¥Ό λ‚νƒ€λ‚΄λ” λ³€μ μ΄κΈ°ν™”

for i in range(n):
    if not q:  # νκ°€ λΉ„μ–΄μλ” κ²½μ°
        print(0)  # μμ„μ— λ§κ² λ°©λ¬Έν•μ§€ λ»ν• κ²½μ° μ¶λ ¥ν•κ³  μΆ…λ£
        exit()

    x = q.popleft()  # νμ—μ„ λ…Έλ“λ¥Ό κΊΌλƒ„
    if x != order[i]:  # ν„μ¬ λ…Έλ“μ™€ μμ„κ°€ μΌμΉν•μ§€ μ•λ” κ²½μ°
        print(0)  # μμ„μ— λ§κ² λ°©λ¬Έν•μ§€ λ»ν• κ²½μ° μ¶λ ¥ν•κ³  μΆ…λ£
        exit()

    cnt = 0  # ν„μ¬ λ…Έλ“μ μμ‹ λ…Έλ“ κ°μλ¥Ό μ €μ¥ν•λ” λ³€μ μ΄κΈ°ν™”
    for y in a[x]:
        if check[y] == False:  # μ•„μ§ λ°©λ¬Έν•μ§€ μ•μ€ μμ‹ λ…Έλ“μΈ κ²½μ°
            parent[y] = x  # λ¶€λ¨ λ…Έλ“ μ •λ³΄ μ—…λ°μ΄νΈ
            cnt += 1  # μμ‹ λ…Έλ“ κ°μ μ¦κ°€

    for j in range(cnt):
        if m + j >= n or parent[order[m + j]] != x:  # μμ„μ— λ§κ² λ°©λ¬Έν•μ§€ λ»ν• κ²½μ°
            print(0)  # μμ„μ— λ§κ² λ°©λ¬Έν•μ§€ λ»ν• κ²½μ° μ¶λ ¥ν•κ³  μΆ…λ£
            exit()
        q.append(order[m + j])  # λ‹¤μ λ°©λ¬Έν•  λ…Έλ“λ¥Ό νμ— μ¶”κ°€
        check[order[m + j]] = True  # λ…Έλ“ λ°©λ¬Έ μ²λ¦¬
    m += cnt  # λ°©λ¬Έ μμ„ λ¦¬μ¤νΈμ μΈλ±μ¤ μ—…λ°μ΄νΈ

print(1)  # μμ„μ— λ§κ² λ°©λ¬Έν• κ²½μ° 1 μ¶λ ¥
